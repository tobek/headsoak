.note
  +card

  position: relative
  display: block
  border-bottom: 3px solid transparent
  transition: box-shadow $transition-gonzales, border $transition-med

  note-browser &
    margin-bottom: 1rem

  &,
  homepage .demo-container & // extra specificity for homepage to override route class that might be there e.g. if you're in route--browse and logout
    padding: 54px 10px 35px 1rem // More magic numbers (correctly vertically positions header and note actions). Left padding is needed in order for body input scrollbar to not be flush against body text nor flush against edge of note. These values (+ right padding on .body-input) are close enough on all browser widths it seems, especially since right edge of text isn't clear because of non-justified left-alignment.

  .note-wrapper
    height: 100%

  .header,
  .note-actions
    position: absolute
    width: 100%
    height: 30px

  .note-actions
    white-space: nowrap
    overflow: hidden

  .header
    top: 0
    left: 0

  .tags
    overflow: hidden
    width: 100%
    max-height: 2.5rem
    padding: 0.25rem 0.5rem 0.5rem
    // background-color: transparent
    background-color: $pane-bar-bg-color
    +box-shadowed-small-light
    border-bottom: 2px solid transparent

    // @TODO/animation Animation looks weird cause either max-height has to be huge or be smaller but scrollable. If scrollable then scroll bar shows during animation. For now doing max-height none and no animatino
    // transition: max-height $transition-fast, padding $transition-fast, border-color $transition-fast

  .tag-like
    cursor: pointer

    // @TODO/ece Right now hover just makes + icon change color. Should it instead flip bg color and text color like hover on tag in tag browser?
    &:hover .fa
      color: $icon-hover

  &.is--adding-tag .tag-like
    cursor: default

    &:hover .fa
      color: $accent-color

    .new-tag-button:hover .fa
      color: $icon-hover

  .new-tag-input
    +tag-face
    width: 0
    background: none
    padding: 0

    transition: width $transition-fast, padding $transition-fast

  &.is--adding-tag .new-tag-input
    width: 100px
    padding: 0 2px

  .new-tag-button
    cursor: pointer
    color: $accent-color

    .fa
      +small

  .note-id
    cursor: default

  .expand-tags
    +icon-button
    display: none
    position: absolute
    top: 0
    right: 0
    color: $accent-color

    .go-up,
    .go-down
      +fadeable

    .go-down
      +faded-in
      position: relative
      top: 0.25rem

    .go-up
      +faded-out
      position: absolute
      top: 0.5rem

  &.has--tag-overflow
    .tags
      padding-right: 30px // to make room for .expand-tags
      transition: background-color $transition-fast
    .expand-tags
      display: inline-block

  &.is--adding-tag,
  &.is--focused
    box-shadow: 0px 6px 10px 5px $shadow-color
    border-bottom-color: $highlight-color

  &.is--expanded
    .expand-tags
      .go-down
        +faded-out
      .go-up
        +faded-in

    .tags
      +menu-dropdown
      background-color: $pane-bar-bg-color
      // overflow-y: auto
      // max-height: 200px // should be more than enough, and in case not, we can scroll
      // @TODO/animation Just snapping to this for now, see note on .tags above
      max-height: none
      padding-bottom: 10px


  .body-input
    resize: none
    width: 100%
    max-height: 133px // 6.5 lines of text (so that clipping is obvious)
    padding: 2px 20px 2px 2px // see note about right padding in base .note styles // @NOTE if right padding changes here it must also be changed for .body-input overrides in .route--list
    border: 0
    outline: none
    white-space: pre-wrap

    transition: min-height $transition-fast, max-height $transition-fast, padding $transition-fast

  &.is--adding-tag .body-input,
  &.is--focused .body-input
    max-height: calc(#{$full-height} - 100px) // magic numbers - 100px is about the vertical padding of note element plus a bit to spare

  .route--list &,
  .route--browse &
    // Magic numbers just like in normal `note` padding. Top padding should mirror distance from bottom of tags header to tag text itself.
    padding-top: 46px
    padding-bottom: 32px

    .note-actions
      bottom: -2px

  .route--browse &
    .body-input
      max-height: none
      height: 95px

  .route--list &
    margin-bottom: 0.5rem
    padding-bottom: 0.5rem

    .body-input
      +single-line-truncate // @TODO/soon @TODO/polish On chrome with the spellcheck issue, `white-space: nowrap` here is one thing that makes or breaks red line at end of everything if there's *any* wrong spellcheck in body

      // @TODO/style @TODO/polish Would be nice if we could replace <br>s with some character orsomething. For now just limit with height instead. See also in _forms.sass
      // +single-line-contenteditable
      // // @TODO/now @TODO/hack This should come in from `single-line-contenteditable`
      // br
      //   display: none
      //   &:after// not in single-line-contenteditable, but maybe it should be?
      // *
      //   display: inline
      //   white-space: nowrap

      height: ($base-line-height-multiple + 0.05) * 1rem // seems like if we don't add a little, then when you focus it gets that much bigger
      min-height: ($base-line-height-multiple + 0.05) * 1rem // for animation for small notes

      padding-right: 50px // magic number to make room for up to two active note action icons @TODO/polish ideally this would depend on exact number of active icons (which in the future could be 3 - shared, private, archived/pinned)

    .note-actions
      width: auto
      right: 0
      bottom: 2px
      left: auto

    &:hover
      .body-input
        overflow: hidden // repeat of normal `.route--list .body-input` but added here too for specificity
        padding-right: 130px // magic number to make room for ALL note-actions

    &.is--adding-tag,
    &.is--focused
      .body-input
        overflow-y: auto
        white-space: pre-wrap

        // @TODO/polish Cause we set max-height to none not a specific value, it won't animate the expansion without some JS. However it *does* animate expanding short notes with min-height, and animates a bit when the thing is being unfocused. @TODO/ece Should it be all or nothing?
        height: auto

        // Back to normal since when expanded, we make room for note actions at the bottom
        padding-right: 20px // @NOTE This reflects default value defined for `.note .body-input`

      &:not(.is--textless)
        padding-bottom: 2rem // make room for note actions at the bottom

        .body-input
          min-height: 95px
        


  .note-actions
    height: 30px
    left: 0;
    bottom: 2px
    padding: 0 10px

    text-align: right
    font-size: 20px

  .note-action
    +icon-button

    position: relative

    &:last-child
      margin-right: 0

  .note-action--open
    float: left

  .note-action--private
    .locked
      display: none

    &:hover,
    &.is--active
      .locked
        display: inline-block
      .unlocked
        display: none

    &.is--active:hover
      .locked
        display: none
      .unlocked
        display: inline-block

  // .explore
  //   z-index: 1
  //   position: absolute
  //   top: 100%
  //   left: 5px
  //   width: calc(100% - 10px)
  //   height: 0
  //   padding: 0 15px
  //   overflow-y: auto
  //   background: fade-out($primary-color, 0.05)
  //   color: $primary-color-contrast

  //   transition: opacity $transition-fast, visibility $transition-fast, max-height $transition-fast ease-in, padding $transition-fast ease-out
  //   +faded-out

  // &.show--explore
  //   .explore
  //     +faded-in
  //     height: calc(100vh - #{$header-height} - 100% - 15px) // 100% to get note height, 15px to give a bit of breathing room
  //     padding: 15px

  //     @media (max-height: 600px)
  //       height: 300px


  .note-action
    .fa
      transition: color $transition-fast, visibility $transition-fast, width $transition-fast
      color: $primary-color-light

    // re-set-up colors cause we overrode them by using primary-color-light for these normally
    &:hover .fa
      color: $icon-hover
    &.is--active .fa
      color: $icon-active
    &.is--active:hover .fa
      color: $primary-color

  // slide-fade-in effect
  note-browser &
    .note-action .fa
      +faded-out
      width: 0

    &.is--adding-tag,
    &.is--focused,
    &:hover
      .note-action .fa
        +faded-in
        width: 1.3em // just copied from what font-awesome gives to fixed width icons

    .note-action.is--active,
      .fa
        +faded-in
        width: 1.3em


    .body-input
      overflow: hidden

    &.is--focused,
    &:hover
      .body-input
        overflow-y: auto

      // Need to add scrollbar if needed, but don't want text to reflow with different line breaks when scrollbar takes up some width. This hack works on Chrome on Linux, needs browser testing (however even if it's a bit off and sometimes causes reflow, well that's the normal behavior, so as long as it's not that much worse...)
      // @REMOVED/note text overflow Turns out the assumption of 12px scrollbar (and/or the general method) is not x-browser friendly, so disabling - we could use <https://davidwalsh.name/detect-scrollbar-width> to work out scrollbar width and set up a CSS class at runtime
      // &.is--text-overflowing .body-input
      //   overflow-y: scroll // force this otherwise sometimes the widening of the text will remove the need for a scroll bar and then it just inexplicably gets bigger!
      //   width: calc(100% + 12px)
      //   padding-right: 8px // 12px less than normal padding
      //   margin-left: -12px
      //   padding-left: 14px // 12px more than normal padding


  .route--scroll &
    .body-input
      padding-left: 10px

      +susy-breakpoint($screen-small, $susy)
        // These achieve a "max width" of 600px while filling the rest with padding. Additionally, it's aligned a little towards the left from centered
        padding-right: calc(75% - 450px)
        padding-left: calc(25% - 150px)

    // @REMOVED/note text overflow Along with bit above
    // &.is--focused,
    // &:hover
    //   &.is--text-overflowing .body-input
    //     padding-left: 22px // 12px more than normal

    //     +susy-breakpoint($screen-small, $susy)
    //       padding-right: calc(75% - 450px - 12px)
    //       padding-left: calc(25% - 150px + 12px)


// This actually gets shunted into ModalComponent but let's style it here
// @TODO/ece What do you think of this whole thing?
.explore-note
  .time-chunk
    display: inline-block
    width: 50%
    min-width: 120px // magic number that looks about right for room for splitting date/time onto two lines but no more
    margin-bottom: 2rem

  h5
    +setting-heading
    margin: 0.5rem 0
