<!-- @TODO/polish Would be nice to animate/crossfade the active panes -->

<div *ngIf="activePane === 'explore'">
  <!-- @TODO/ece Should there be a hashtag here? (if so, search elsewhere on this page where tag.name is mentioned) -->
  <h3 class="pane-heading">Explore <span class="static-tag">{{ tag.name }}</span></h3>

  <div class="note-count-heading">{{ tag.noteCount }} Note{{ tag.noteCount !== 1 ? 's' : '' }}</div>
  
  <tag-visualization *ngIf="tag.noteCount" [centralTag]="tag" [highlightedTag]="hoveredTag"></tag-visualization>

  <p *ngIf="! exploreComputed">
    <i class="fa fa-spin fa-cube"></i>&nbsp;
    Loading tag stats...
  </p>

  <div *ngIf="exploreComputed">
    <h4 *ngIf="! exploreStats.topCooccurrences.length && ! exploreStats.bottomCooccurrences.length">This tag has not been paired with any other tags.</h4>

    <div *ngIf="exploreStats.topCooccurrences.length" class="cooccurrences">
      <h4>Most commonly paired with:</h4>

      <ul class="cooccurring-tags">
        <li *ngFor="let cooccurrence of exploreStats.topCooccurrences">
          <span
            (mouseenter)="hoveredTag = cooccurrence.tag"
            (mouseleave)="hoveredTag = null"
          >
            <span class="static-tag"
              [routerLink]="['/tags/tag', cooccurrence.tag.parentTagId, cooccurrence.tag.name]"
            >{{ cooccurrence.tag.name }}</span>

            <!-- @TODO/tags Should link these to the search query! -->
            <span class="common-notes-link">{{ cooccurrence.numNotes }} common note{{ cooccurrence.numNotes !== 1 ? 's' : '' }}</span>
          </span>
        </li>
      </ul>
    </div>

    <div *ngIf="exploreStats.bottomCooccurrences.length" class="cooccurrences">
      <h4>Least commonly paired with:</h4>

      <ul class="cooccurring-tags">
        <li *ngFor="let cooccurrence of exploreStats.bottomCooccurrences">
          <span
            (mouseenter)="hoveredTag = cooccurrence.tag"
            (mouseleave)="hoveredTag = null"
          >
            <span class="static-tag"
              [routerLink]="['/tags/tag', cooccurrence.tag.parentTagId, cooccurrence.tag.name]"
            >{{ cooccurrence.tag.name }}</span>

            <span class="common-notes-link">{{ cooccurrence.numNotes }} common note{{ cooccurrence.numNotes !== 1 ? 's' : '' }}</span>
          </span>
        </li>
      </ul>
    </div>
  </div>
</div>

<div *ngIf="activePane === 'share'">
  <h3 class="pane-heading">Manage sharing for <span class="static-tag">{{ tag.name }}</span></h3>
  <p>This tag is <b>{{ tag.share ? '' : 'not' }} shared</b>. You can't change this right now.</p>
</div>

<div *ngIf="activePane === 'smartness' && ! tag.internal">
  <h3 class="pane-heading">Smart Tag settings for <span class="static-tag">{{ tag.name }}</span></h3>

  <prog-tag-control [tag]="tag"></prog-tag-control>
</div>

<div *ngIf="activePane === 'privacy'">
  <h3 class="pane-heading">Manage privacy for <span class="static-tag">{{ tag.name }}</span></h3>
  <p>This tag is <b>{{ tag.private ? '' : 'not' }} hidden</b>. You can't change this right now.</p>
</div>

<div *ngIf="activePane === 'delete' && ! tag.internal">
  <h3 class="pane-heading">Delete <span class="static-tag">{{ tag.name }}</span></h3>

  <p *ngIf="tag.noteCount === 0">This tag isn't used on any of your notes, so deleting it isn't really a big deal.</p>

  <p *ngIf="tag.noteCount !== 0">Deleting this tag will remove if from {{ tag.noteCount === 1 ? 'the 1 note' : 'all ' + tag.noteCount + ' notes' }} tagged with it. {{ tag.noteCount === 1 ? 'That note' : 'Those notes' }} will remain undeleted.</p>

  <p *ngIf="! tag.isLibraryTag">
    Are you sure you want to continue? This can't be undone.
  </p>
  <p *ngIf="tag.isLibraryTag">
    Do you want to continue? You can always re-enable this tag again from the <a [routerLink]="['/tags/smart-tags/library']">Smart Tag Library</a> later.
  </p>

  <button class="btn" [class.btn-danger]="! tag.isLibraryTag" (click)="_deleted()">Yes, delete this tag</button>
  </div>
