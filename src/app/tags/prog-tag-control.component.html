<p>
  This tag is <b>{{ tag.prog ? '' : 'not' }} smart</b>.<span *ngIf="tag.prog"> It is on <b>{{ tag.docs.length || 0 }}</b> note{{ tag.docs.length === 1 ? '' : 's' }}.</span>

  <span *ngIf="tag.isLibraryTag">It comes from the <a [routerLink]="['/tags/smart-tags/library']">smart tag library</a>, so it can't be modified. You can <a [routerLink]="['/tags/tag', tag.id, tag.name, 'delete']">delete</a> it though.</span>
</p>
<p *ngIf="! tag.isLibraryTag">
  Smart tags let you write your own algorithms that determine which notes the tag is assigned to, and perform custom actions on those notes.
</p>

<button class="btn btn-secondary"
  *ngIf="tag.prog && ! tag.readOnly"
  (click)="makeDumb()"
>Revert to normal tag</button>

<button class="btn btn-secondary"
  *ngIf="! tag.prog && ! tag.readOnly"
  (click)="makeSmart()"
>Make smart</button>

<div class="code-container" [class.is--disabled]="! tag.prog">
  <div class="disabled-cover"></div>

  <pre class="function-wrapper">function(note) {{ '{' }}</pre>
  <pre ref-editorRef class="code-editor">{{ tag.progFuncString }}</pre>
  <pre class="function-wrapper">{{ '}' }}</pre>

  <div *ngIf="! tag.readOnly">
    <button class="btn btn-primary"
      [class.is--loading]="isRunning"
      [disabled]="! changed || isRunning"
      (click)="saveAndRun()"
    >Save and run</button>

    <button class="btn btn-secondary"
      [disabled]="! changed || isRunning"
      (click)="revertChanges()"
    >Revert changes</button>
  </div>
</div>

<div class="documentation">
  <h1>Documentation</h1>

  <p>Headsoak will test each of your notes against the function you write above in order to determine if a note should have the "{{ tag.name }}" tag.</p>
  <p>If your function returns true for a note, that note is tagged with this tag - otherwise it's not tagged, and is untagged if it previously was tagged.</p>
  <p>This function is run on every note when the tag is updated, and whenever a note is modified  in the future it is retested against all smart tags.</p>

  <h2>Properties in scope</h2>

  <h3><code>this</code></h3>

  <p>The smart tag object "{{ tag.name }}" is supplied as <code>this</code> to this function. The public <code>Tag</code> model is as follows:</p>

  <pre>id: string;
name: string;
created: number; // unix timestamp
modified: number; // unix timestamp
docs: string[]; // array of note IDs tagged with this tag</pre>

  <h3><code>note</code></h3>

  <p>Each function is passed the current note being tested for membership in this tag. The public <code>Note</code> model is as follows:</p>

  <pre>id: string;
body: string; // text of the name
created: number; // unix timestamp
modified: number; // unix timestamp
tags: string[]; // array of tag IDs this note is tagged with
private: boolean; // whether this note is a private note</pre>

  <h3><code>api</code></h3>
  <p><i>(under development)</i></p>
  <p>You are also provided an API to access various capabilities of Headsoak.</p>

  <ul>
    <li><code>api.notes</code> - All of your notes in an object mapping IDs to <code>Note</code> instances.</li>
    <li><code>api.tags</code> - All of your tags in an object mapping IDs to <code>Tag</code> instances.</li>
  </ul>

  <h3><code>_</code></h3>
  <p>Lodash is in scope for you convenience. <a href="https://lodash.com/docs/4.16.2" target="_blank">See their docs.</a>

  <h2>Note-specific data: child tags and scores</h2>

  <p>A tag such as <code>nsfw</code> doesn't have any special data associated with it: a note either has it or doesn't. Some smart tags, however, may want to attach specific data to a note. For example, a language detection algorithm may mark a note as <code>language: english</code> or <code>language: italian</code>. Instead of returning <code>true</code>, your function may return the following object:</p>

  <pre>{{ '{' }}
    childTag: 'italian'
{{ '}' }}</pre>

  <p>This value would be shown as part of the tag when it's displayed on the note, and users will be able to filter their notes by child tags.</p>

  <p>Some smart tags may not have discrete child tags but may have a score, which could be any number. For example you might have a <code>word count</code> tag that calculates word counts. For this you can return something like the following:</p>

  <pre>{{ '{' }}
    score: 842
{{ '}' }}</pre>

  <p>The above value would be displayed on the tag as well, e.g. <code>word count: 842</code>.</p>

  <p><code>childTag</code> and <code>score</code> can be combined, for instance a sentiment analysis tag might return the strength of the associated sentiment:</p>

  <pre>{{ '{' }}
    childTag: 'joy',
    score: 0.82
{{ '}' }}</pre>

  <p>The above would be displayed as <code>sentiment: joy</code>, and on hover would show <code>sentiment: joy (0.82)</code>.

  <!-- @TODO/prog Also store "more" or "description" and also multiple childTags -->

  <h2>Sorting and searching within a single smart tag</h2>

  <p><i>(under development)</i></p>

  <p>Searching for a specific <code>childTag</code> (e.g. <code>sentiment: joy</code>) is currently possible - sorting by <code>childTag</code> and/or  <code>score</code>s will be possible in the future.</p>

  <h2>Using external resources</h2>

  <p><i>(under development)</i></p>

  <p>Smart tags will be able to import external JavaScript libraries and may make JSON API requests.

  <h2>Testing, debugging, and error-handling</h2>

  <p><i>(under development)</i></p>
</div>
