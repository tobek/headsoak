<!-- `[hidden]` not `*ngIf` because it's wasteful/slow to re-initialize the tag browser view every time you go out of details. -->
<div [hidden]="activeTag">
  <div class="overview tag-list">
    <ul class="menu menu--tag-home">
      <li class="item" [routerLink]="['/tags']" [class.is--active]="activePane === 'viz'">
        <i class="fa fa-fw fa-lg fa-connectdevelop"></i>
        Explore your tags
        <!-- @TODO/ece Capitalzation of side menu. We have "Private Mode" in settings, but "Smart tag" in tag details. -->
      </li>
      <li class="item" [routerLink]="['/tags/smart-tags/library']" [class.is--active]="activePane === 'library'">
        <i class="fa fa-fw fa-lg fa-book"></i>
        Smart Tag Library
      </li>
    </ul>

    <div class="tag-query">
      <div class="search-bar">
        <input class="text-input" tabindex=1 type="text" placeholder="Search your tags"
          ref-queryInput [(ngModel)]="query"
          (ngModelChange)="queryUpdated()"
        >
        <button class="clear" (click)="queryClear()">x</button>
      </div>

      <div class="controls">
        <label>
          {{ tags.length }} TAG{{ tags.length !== 1 ? 'S' : '' }}
          <select tabindex=3 [ngModel]="sortOpt" (ngModelChange)="sort($event)">
            <option *ngFor="let opt of tagsService.sortOpts" [ngValue]="opt">{{opt.name}}</option>
          </select>
        </label>
      </div>
    </div>

    <!-- @TODO/polish It would be slick if this had the exact same UI as adding a tag on a note, with the line sliding out etc. But that's harder. Prob would have to refactor stuff from NoteComponent into an AddTagComponent, or update how TagComponent handles its own new tag state so that it's always there and can morph into creating a tag, and then add that extra component to all notes and here, etc. -->
    <div class="add-new-tag" (click)="newTag()" *ngIf="! addingNewTag">
      <i class="fa fa-plus"></i>
      <span class="text">Add new tag</span>
    </div>

    <div *ngFor="let tag of (tags | arrayLimit:limit)" class="tag-wrapper" [class.is--expanded]="expandedTag === tag">
      <span class="caret-wrapper" (click)="expandedTag = expandedTag === tag ? null : tag">
        <span class="caret"></span>
      </span>

      <tag class="tag tag-{{ tag.id }}"
        [routerLink]="['/tags/tag', tag.id, tag.name]"
        [tag]="tag"
        [renamable]="expandedTag === tag"
        showCount=1
        (mouseenter)="hoveredTag = tag.name ? tag : null"
        (mouseleave)="hoveredTag = null"
      ></tag><!-- checking tag.name in mouseenter to make sure it's not a new/unsaved tag -->

      <div class="tag-manager" *ngIf="expandedTag === tag">
        <ul class="menu">
          <li class="item" [routerLink]="['/tags/tag', tag.id, tag.name]" [class.is--active]="activePane === 'explore'">
            <i class="fa fa-fw fa-lg fa-bar-chart"></i>
            Explore
          </li>
          <li *ngIf="! tag.internal" class="item" [routerLink]="['/tags/tag', tag.id, tag.name, 'smartness']" [class.is--active]="activePane === 'smartness'">
            <i class="fa fa-fw fa-lg fa-bolt"></i>
            Smart tag
          </li>
          <!-- @TODO/tags @TODO/privacy
          <li class="item" [routerLink]="['/tags/tag', tag.id, tag.name, 'privacy']" [class.is--active]="activePane === 'privacy'">
            <i class="fa fa-fw fa-lg fa-lock"></i>
            Private tag
          </li>
          -->
          <li *ngIf="! tag.internal" class="item" [routerLink]="['/tags/tag', tag.id, tag.name, 'delete']" [class.is--active]="activePane === 'delete'">
            <i class="fa fa-fw fa-lg fa-trash-o"></i>
            Delete
          </li>
        </ul>
      </div>
    </div>

    <hr style="width: 100%">
    <h4>System Tags</h4>
    <div *ngFor="let tag of tagsService.internalTags" class="tag-wrapper">
      <!-- @TODO/refactor Copy-pasting from normal tags... -->
      <span class="caret-wrapper" (click)="expandedTag = expandedTag === tag ? null : tag">
        <span class="caret"></span>
      </span>

      <tag class="tag tag-{{ tag.id }}"
        [routerLink]="['/tags/tag', tag.id, tag.name]"
        [tag]="tag"
        showCount=1
        (mouseenter)="hoveredTag = tag"
        (mouseleave)="hoveredTag = null"
      ></tag>

      <!-- @TODO/refactor Copy-pasting from normal tags... but a little different, cause you can't rename, delete, or smart tag these -->
      <div class="tag-manager" *ngIf="expandedTag === tag">
        <ul class="menu">
          <li class="item" [routerLink]="['/tags/tag', tag.id, tag.name]" [class.is--active]="activePane === 'explore'">
            <i class="fa fa-fw fa-lg fa-bar-chart"></i>
            Explore
          </li>
          <!-- @TODO/tags @TODO/privacy
          <li class="item" [routerLink]="['/tags/tag', tag.id, tag.name, 'privacy']" [class.is--active]="activePane === 'privacy'">
            <i class="fa fa-fw fa-lg fa-lock"></i>
            Private tag
          </li>
          -->
        </ul>
      </div>
    </div>
  </div>

  <div class="fixed-pane-wrapper">
    <div class="tag-pane fixed-pane-contents">
      <tag-visualization *ngIf="activePane === 'viz'" class="all-tags" [highlightedTag]="hoveredTag"></tag-visualization>

      <prog-tag-library *ngIf="activePane === 'library'"></prog-tag-library>
    </div>
  </div>
</div>

<tag-details
  *ngIf="activeTag"
  [tag]="activeTag"
></tag-details>
